<source>
  @type  forward
  @id    input1
  @label @mainstream
  port  24224
</source>

<filter **>
  @type stdout
</filter>

<label @mainstream>
  <match docker.**>
    @type copy

    <store>
      @type stdout
    </store>

    <store>
      @type s3
      @id output_s3
      aws_key_id "#{ENV['AWS_ACCESS_KEY']}"
      aws_sec_key "#{ENV['AWS_SECRET_ACCESS_KEY']}"
      s3_bucket "#{ENV['AWS_S3_BUCKET_NAME']}"
      s3_region "#{ENV['AWS_S3_REGION']}"
      format ltsv
      path logs/
      buffer_path /fluentd/log

      time_slice_format %Y%m%d
      time_slice_wait 60m
      utc

      buffer_chunk_limit 256m
    </store>
  </match>
</label>
